<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Trang qu·∫£n tr·ªã Vconnex</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <style>
    body { background: #f7f9fc; }
    .sidebar { min-height: 100vh; background: #ffffff; border-right: 1px solid #ddd; }
    .sidebar a { display: block; padding: 12px 20px; color: #333; text-decoration: none; }
    .sidebar a.active, .sidebar a:hover { background: #e9ecef; font-weight: bold; }
  </style>
</head>
<body>
  <div id="adminApp" class="container-fluid">
    <div class="row">
      
      <!-- Sidebar tr√°i -->
      <div class="col-md-3 col-lg-2 sidebar">
        <h5 class="mt-4 mb-3 px-3 text-primary">Qu·∫£n tr·ªã</h5>
        <a href="#" :class="{active: tab==='consultations'}" @click.prevent="tab='consultations'">üìã Danh s√°ch ƒëƒÉng k√Ω</a>
        <a href="#" :class="{active: tab==='products'}" @click.prevent="tab='products'">üì¶ Qu·∫£n l√Ω s·∫£n ph·∫©m</a>
      </div>

      <!-- Ph·∫ßn n·ªôi dung ph·∫£i -->
      <div class="col-md-9 col-lg-10 py-4">

        <!-- Danh s√°ch ƒëƒÉng k√Ω -->
        <div v-if="tab==='consultations'">
          <h4 class="mb-3 text-primary">Danh s√°ch ƒëƒÉng k√Ω t∆∞ v·∫•n (ch∆∞a x·ª≠ l√Ω)</h4>
          <a href="/admin/done" class="btn btn-secondary mb-3">Xem danh s√°ch ƒë√£ t∆∞ v·∫•n</a>

          <table class="table table-bordered bg-white shadow-sm">
            <thead class="table-light">
              <tr><th>#</th><th>H·ªç t√™n</th><th>SƒêT</th><th>G√≥i</th><th>Ghi ch√∫</th><th>Ng√†y g·ª≠i</th><th>Thao t√°c</th></tr>
            </thead>
            <tbody>
              <% if (consultations.length === 0) { %>
                <tr><td colspan="7" class="text-center">Ch∆∞a c√≥ ƒëƒÉng k√Ω n√†o</td></tr>
              <% } else { %>
                <% consultations.forEach((item, index) => { %>
                  <tr>
                    <td><%= index + 1 %></td>
                    <td><%= item.name %></td>
                    <td><%= item.phone %></td>
                    <td><%= item.solution %></td>
                    <td><%= item.message %></td>
                    <td><%= new Date(item.createdAt).toLocaleString('vi-VN') %></td>
                    <td>
                      <form method="POST" action="/admin/mark-done/<%= item._id %>" class="d-inline">
                        <button class="btn btn-success btn-sm">ƒê√£ t∆∞ v·∫•n</button>
                      </form>
                      <form method="POST" action="/admin/delete/<%= item._id %>" class="d-inline" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a?')">
                        <button class="btn btn-danger btn-sm">X√≥a</button>
                      </form>
                    </td>
                  </tr>
                <% }) %>
              <% } %>
            </tbody>
          </table>
        </div>

        <!-- Qu·∫£n l√Ω s·∫£n ph·∫©m -->
        <div v-if="tab==='products'">
          <h4 class="mb-4 text-success">Qu·∫£n l√Ω s·∫£n ph·∫©m</h4>
          <form @submit.prevent="addProduct" class="row g-3 mb-4">
            <div class="col-md-3"><input v-model="form.name" class="form-control" placeholder="T√™n s·∫£n ph·∫©m" required></div>
            <div class="col-md-3"><input v-model="form.imageUrl" class="form-control" placeholder="Link ·∫£nh" required></div>
            <div class="col-md-2"><input v-model="form.price" type="number" class="form-control" placeholder="Gi√°" required></div>
            <div class="col-md-4"><input v-model="form.description" class="form-control" placeholder="M√¥ t·∫£"></div>
            <div class="col-12"><button class="btn btn-primary">+ Th√™m s·∫£n ph·∫©m</button></div>
          </form>

          <table class="table table-bordered table-striped">
            <thead>
              <tr><th>·∫¢nh</th><th>T√™n</th><th>Gi√°</th><th>M√¥ t·∫£</th><th></th></tr>
            </thead>
            <tbody>
              <tr v-for="p in products" :key="p._id">
                <td><img :src="p.imageUrl" width="60" /></td>
                <td>{{ p.name }}</td>
                <td>{{ p.price }} ƒë</td>
                <td>{{ p.description }}</td>
                <td><button @click="deleteProduct(p._id)" class="btn btn-sm btn-danger">Xo√°</button></td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>

  <script>
    const { createApp, reactive, ref, onMounted } = Vue;

    createApp({
      setup() {
        const tab = ref('consultations');
        const products = reactive([]);
        const form = reactive({ name: '', imageUrl: '', price: '', description: '' });

        const fetchProducts = async () => {
          const res = await fetch('/api/products');
          const data = await res.json();
          products.splice(0, products.length, ...data);
        };

        const addProduct = async () => {
          const res = await fetch('/api/products', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(form)
          });
          if (res.ok) {
            Object.assign(form, { name: '', imageUrl: '', price: '', description: '' });
            await fetchProducts();
          }
        };

        const deleteProduct = async (id) => {
          if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën xo√° s·∫£n ph·∫©m n√†y?')) {
            await fetch(`/api/products/${id}`, { method: 'DELETE' });
            await fetchProducts();
          }
        };

        onMounted(fetchProducts);

        return { tab, products, form, addProduct, deleteProduct };
      }
    }).mount('#adminApp');
  </script>
</body>
</html>